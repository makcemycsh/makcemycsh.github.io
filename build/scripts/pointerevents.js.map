{"version":3,"sources":["pointerevents.js"],"names":["is_touch_device","window","$","document","body","addClass","Handler","selector","_classCallCheck","this","$img","$imgWrap","height","minHeight","parent","$scroll","oldTop","difX","left","top","oldLeft","curPosX","curPosY","difY","leftLim","undefined","topLim","zoom","maxHeight","getLim","lastTap","width","e","events","length","console","log","identifier","append","x1","y1","x2","y2","originalEvent","pointerId","clientX","clientY","curDistance","getDistance","checkLim","css","moveScroll","Math","sqrt","pow","persent","now","Date","getTime","zoomImg","start","push","filter","item","_this","pointerMove","on","pointerDown","timesince","pointerUp"],"mappings":"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","file":"pointerevents.js","sourcesContent":["function is_touch_device() {\n  return !!('ontouchstart' in window);\n}\n\n// Проверяем тип устройства\nif (is_touch_device()) $(document.body).addClass('is-touch');\nelse $(document.body).addClass('no-touch');\n\nclass Handler {\n  constructor(selector) {\n    this.selector = $(selector);\n    this.$imgWrap = $('.js-img-wrapper', this.selector);\n    this.$img = $('img', this.$imgWrap);\n    this.$scroll = $('.js-scroll', this.selector);\n\n    this.height = this.$img.height();\n    this.minHeight = this.$imgWrap.parent().height();\n\n    this.left = 0;\n    this.top = 0;\n    this.oldLeft = 0;\n    this.oldTop = 0;\n    this.curPosX = 0;\n    this.curPosY = 0;\n    this.difX = 0;\n    this.difY = 0;\n    this.leftLim = 0;\n    this.topLim = 0;\n\n    this.events = [];\n    this.distance = 0;\n\n    this.zoom = false;\n    this.lastTap = undefined;\n    this.hendlPointerEvents(this.selector);\n  }\n\n  zoomImg() {\n    if (this.zoom) {\n      this.$img.height(this.height);\n      this.zoom = !this.zoom;\n    } else {\n      this.height = this.$img.height();\n      this.maxHeight = 2 * this.height;\n      this.$img.height(this.maxHeight);\n      this.getLim();\n      this.zoom = !this.zoom;\n    }\n  }\n\n  getLim() {\n    this.topLim = (this.$imgWrap.height() - this.$imgWrap.parent().height()) / 2;\n    this.leftLim = (this.$imgWrap.width() - this.$imgWrap.parent().width()) / 2;\n  }\n\n  checkLim() {\n    this.top >= this.topLim ? this.top = this.topLim : '';\n    this.top <= -this.topLim ? this.top = -this.topLim : '';\n\n    this.left >= this.leftLim ? this.left = this.leftLim : '';\n    this.left <= -this.leftLim ? this.left = -this.leftLim : '';\n  }\n\n  pointerMove(e) {\n    if (this.events.length === 2) {\n      console.log(e.identifier);\n      $('.js-debag').append('<div>' + this.events + '</div>');\n\n      let x1, y1, x2, y2;\n      if (e.originalEvent.pointerId === this.events[0]) {\n        x1 = e.clientX;\n        y1 = e.clientY;\n      } else if (e.originalEvent.pointerId === this.events[1]) {\n        x2 = e.clientX;\n        y2 = e.clientY;\n      }\n      $('.js-debag').append('<div>' + x1 + ' ' + y1 + ' ' + x2 + ' ' + y2 + '</div>');\n\n      let curDistance = this.getDistance(x1, y1, x2, y2);\n      $('.js-debag').append('<div>' + curDistance + '</div>');\n\n      // if (curDistance !== this.distance) {\n      //   let dif = curDistance - this.distance;\n      //   let newHeight = this.$img.height + dif;\n      //   this.$img.height(this.$img.height + dif);\n      //   this.getLim();\n      //   $('.js-debag').append('<div>' + dif + '</div>');\n      //\n      // }\n    } else {\n\n      this.left += e.clientX - this.oldLeft;\n      this.top += e.clientY - this.oldTop;\n\n      this.checkLim();\n      this.$img.css('transform', 'translate(' + this.left + 'px, ' + this.top + 'px)');\n      this.$scroll.css('left', this.moveScroll() + '%');\n      this.oldLeft = e.clientX;\n      this.oldTop = e.clientY;\n\n    }\n    // $('.js-debag').append('<div>' + e.pointerId + '</div>');\n  }\n\n  getDistance(x1, y1, x2, y2) {\n    return Math.sqrt(Math.pow((x2 - x1), 2) + Math.pow((y2 - y1), 2));\n  }\n\n  moveScroll() {\n    let start = 15;\n    let end = 85;\n    let persent = (this.left + this.leftLim) * 100 / (this.leftLim * 2);\n    persent = persent * 0.7 + start;\n    persent > end ? persent = end : '';\n    persent < start ? persent = start : '';\n    return persent;\n  }\n\n  pointerDown(e) {\n    console.log(e);\n    console.log('pointerDown');\n    let now = new Date().getTime();\n    this.curPosX = e.clientX;\n    this.curPosY = e.clientY;\n    this.oldLeft = e.clientX;\n    this.oldTop = e.clientY;\n    this.getLim();\n\n    let timesince = now - this.lastTap;\n    if ((timesince < 300) && (timesince > 0)) this.zoomImg();\n    this.lastTap = new Date().getTime();\n    console.log(e.originalEvent);\n    this.events.push(e.originalEvent.pointerId);\n    console.log(this.events);\n  }\n\n  pointerUp(e) {\n    this.events = this.events.filter((item) => item !== e.originalEvent.pointerId);\n  }\n\n  hendlPointerEvents(selector) {\n    console.log('hendlPointerEvents');\n    if (is_touch_device()) {\n      selector.on('pointermove', e => this.pointerMove(e));\n      selector.on('pointerdown', e => this.pointerDown(e));\n      selector.on('pointerup', e => this.pointerUp(e));\n\n    }\n  }\n}"],"sourceRoot":"/source/"}